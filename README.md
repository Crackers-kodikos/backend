# Khayt - Complete Business & Technical Overview

## ğŸ“Œ What is Khayt? (The Simple Explanation)

Imagine you own a small clothing boutique in your city. You sometimes need to order **custom-made clothes** from local tailoring workshops. Currently, you:

- Call or visit the workshop manually
- Explain what you need verbally
- Wait and hope they understand
- Don't know when it will be ready
- Can't track progress

**Khayt solves this problem.** It's a **digital platform that connects boutique shops with tailoring workshops**, allowing them to:

- Place orders online with detailed specifications
- Track order progress in real-time
- Know exactly when clothes will be ready
- Manage multiple tailors working on the same order
- Have a professional, organized workflow

---

## ğŸ¯ The Core Problem

### Before Khayt (Traditional Way):

```
Boutique Owner â†’ Calls Workshop â†’ Verbal Miscommunication â†’ Delayed Orders
                                 â†’ No Tracking
                                 â†’ Quality Issues
                                 â†’ Coordination Chaos
```

### With Khayt (Digital Way):

```
Boutique Owner â†’ Online Order â†’ Clear Specifications â†’ Real-time Tracking
                 â†’ Assigned to Tailors â†’ Quality Control â†’ Ready Notification
```

---

## ğŸ‘¥ Who Uses Khayt?

### 1. **Workshop Owner** (The Business)

The person who owns the tailoring workshop.

**What they do:**

- Create an account and set up their workshop
- Choose a subscription plan (like gym memberships)
- Build their team (hire tailors and quality checkers)
- Receive orders from boutique shops
- Track all orders and team productivity
- Get paid based on orders completed

**Analogy:** Like owning a restaurant - they manage staff and serve customers

---

### 2. **Tailor** (The Worker)

The person who actually sews the clothes.

**What they do:**

- Register to join a workshop
- View tasks assigned to them
- Update task status (started, in progress, completed)
- See detailed specifications for each piece
- Get credit for completed work

**Analogy:** Like a restaurant chef - they have tasks and track progress

---

### 3. **Validator/Quality Checker** (The Manager)

The person who checks orders and quality.

**What they do:**

- Check if incoming orders are correct
- Reject orders with mistakes
- Assign work to tailors based on their skills
- Move orders through workflow stages
- Ensure quality standards

**Analogy:** Like a restaurant kitchen manager - they ensure everything is correct

---

### 4. **Boutique Shop Owner/Magazine** (The Customer)

The person who owns a local boutique and needs custom clothes.

**What they do:**

- Find a tailoring workshop
- Place orders specifying exactly what they need
- Track order status in real-time
- Receive notification when ready
- Pick up finished clothes

**Analogy:** Like a customer at a restaurant - they order and track their order

---

## ğŸ”„ How Does the Complete Workflow Work?

### Step-by-Step Process:

```
STEP 1: Workshop Owner Creates Account
â”œâ”€ Fills workshop details (name, address, etc.)
â”œâ”€ Chooses subscription plan (e.g., Professional plan)
â”œâ”€ Pays subscription fee
â””â”€ Gets access to full platform

STEP 2: Workshop Owner Builds Team
â”œâ”€ Creates unique invitation links for tailors
â”œâ”€ Sends link: "Join my workshop: https://Khayt.com/join?code=xyz123"
â”œâ”€ Tailor clicks link and signs up
â””â”€ Tailor now part of the team and can receive work

STEP 3: Boutique Shop Joins
â”œâ”€ Workshop owner creates invitation for boutique shop
â”œâ”€ Boutique owner clicks link and signs up
â”œâ”€ Boutique can now place orders with this workshop

STEP 4: Boutique Places Order
â”œâ”€ Clicks "Create Order"
â”œâ”€ Specifies: "I need 5 elegant dresses, each 2 meters fabric, embroidery on chest"
â”œâ”€ Sets deadline: "Need by November 30"
â”œâ”€ Sets price: "Will pay $250"
â””â”€ Submits order

STEP 5: Quality Checker Reviews Order
â”œâ”€ Validator receives the order
â”œâ”€ Checks if specifications are clear and doable
â”œâ”€ Either APPROVES or REJECTS the order
â”‚  â”œâ”€ If approved â†’ moves to next step
â”‚  â””â”€ If rejected â†’ tells boutique what's wrong
â””â”€ (Boutique can fix and resubmit)

STEP 6: Work Gets Assigned to Tailors
â”œâ”€ Validator looks at the order
â”œâ”€ Knows each tailor's skills: "Ahmed = embroidery expert, Fatima = alterations specialist"
â”œâ”€ Splits work: "Ahmed does embroidery, Fatima does general sewing"
â”œâ”€ Each tailor gets specific tasks
â””â”€ Both receive notifications on their phones

STEP 7: Tailors Complete Work
â”œâ”€ Ahmed sees his task: "Embroider chest on 5 dresses"
â”œâ”€ He marks it: "Started" â†’ "In Progress" â†’ "Completed"
â”œâ”€ Fatima does the same for her part
â””â”€ System tracks time, effort, and completion

STEP 8: Order Status Updates
â”œâ”€ Status moves: PENDING â†’ VALIDATED â†’ TAILORING â†’ PACKAGING â†’ COMPLETED
â”œâ”€ Boutique shop owner can see status anytime: "Ahmed finished, Fatima working on dress #3"
â”œâ”€ Boutique gets push notification: "Your order is 80% complete"
â””â”€ Tailors can see: "Your work is on track, finishing tomorrow"

STEP 9: Order Complete
â”œâ”€ All tailors mark their work done
â”œâ”€ Final quality check
â”œâ”€ Status: COMPLETED
â”œâ”€ Boutique gets notification: "Your order is ready for pickup!"
â””â”€ Workshop prepares order for pickup

STEP 10: Order Picked Up
â”œâ”€ Boutique owner comes to workshop
â”œâ”€ Picks up finished clothes
â”œâ”€ Both parties are happy
â””â”€ Money automatically calculated: "Workshop made $225 (after 10% commission)"
```

---

## ğŸ’° The Subscription Model

### Why Subscriptions?

Just like Netflix has plans (Basic, Standard, Premium), Khayt has plans that give workshops different **limits** on how many shops and tailors they can manage.

### Three Plans:

#### **ğŸŸ¢ Beginner Plan ($\*\***/month)\*\*

- Can work with **3 boutique shops** (you can only take orders from 3 shops)
- Can hire **3 tailors** (your team size)
- Can hire **1 quality checker** (1 manager)
- Can handle **50 orders per month**
- Support: Email only

**Use Case:** Small workshop just starting out, testing the platform

---

#### **ğŸŸ¡ Professional Plan ($\*\***/month)\*\*

- Can work with **10 boutique shops**
- Can hire **10 tailors**
- Can hire **2 quality checkers**
- Can handle **500 orders per month**
- Support: Priority email

**Use Case:** Growing workshop with established client base

---

#### **ğŸ”´ Enterprise Plan ($\*\***/month)\*\*

- Can work with **100+ boutique shops**
- Can hire **100+ tailors**
- Can hire **10+ quality checkers**
- Can handle **5000+ orders per month**
- Support: 24/7 phone support

**Use Case:** Large workshop chain or established business

---

## ğŸ”‘ Key Features Explained in Detail

### Feature 1: **User Roles & Permissions**

**What it means:** Different users have different access levels

```
Workshop Owner:
âœ“ Can see all orders
âœ“ Can manage team
âœ“ Can manage subscription
âœ“ Can see all analytics
âœ— Cannot directly handle orders (delegates to validator)

Validator:
âœ“ Can see all orders
âœ“ Can approve/reject orders
âœ“ Can assign work to tailors
âœ“ Can update order status
âœ— Cannot manage subscription
âœ— Cannot manage other validators

Tailor:
âœ“ Can see only their assigned tasks
âœ“ Can update their task status
âœ“ Can see task details
âœ— Cannot see other tailor's tasks
âœ— Cannot approve orders
âœ— Cannot manage anything

Boutique Shop:
âœ“ Can create orders
âœ“ Can see their own orders
âœ“ Can track order progress
âœ— Cannot see other shops' orders
âœ— Cannot validate or assign work
```

---

### Feature 2: **Invitation Links (The "Referral System")**

**What it really means:** Special links that let workshop owners invite people to join

```
How it works:

Workshop Owner generates link:
"Join my workshop as a tailor: https://Khayt.com/invite?code=abc123xyz"
                                                         â†“
Tailor clicks link â†’ Sees form â†’ Enters details â†’ Automatically joins the workshop

Why this is useful:
- Tailor can join ONLY if they have the link
- Workshop owner controls who can join
- Prevents strangers from registering as tailors
- Easy sharing: Copy-paste link to WhatsApp/Email
```

**Real Example:**

```
Workshop Owner: "Hey Ahmed, join my workshop on Khayt!"
Ahmed: "How?"
Workshop Owner: "Click this link: https://Khayt.com/invite?code=xyz123"
Ahmed: Clicks â†’ Signs up â†’ Now part of team
```

---

### Feature 3: **Order Workflow**

**What it means:** Orders go through different stages

```
Each order moves through these states:

PENDING
  â†“ (Validator reviews)
VALIDATED (Order approved, everything is clear)
  â†“ (Validator assigns to tailors)
TAILORING (Tailors are actively working)
  â†“ (Tailors finish, package work)
PACKAGING (Work packaged, ready)
  â†“ (Final check)
COMPLETED (Ready for pickup)
  â†“
PICKED_UP (Customer took it)
```

Each status change is tracked with timestamp and who made the change.

---

### Feature 4: **Task Assignment**

**What it means:** Breaking down orders into individual tasks for each tailor

```
ORDER: 5 wedding dresses with embroidery

GETS BROKEN INTO:

TASK 1 â†’ Assigned to "Zainab (Embroidery Expert)"
Purpose: Add embroidery on all 5 dress chests
Deadline: Nov 20
Skills needed: Embroidery, hand stitching

TASK 2 â†’ Assigned to "Fatima (Sewing Specialist)"
Purpose: Complete all sewing and alterations
Deadline: Nov 22
Skills needed: General sewing, alterations

Each tailor:
- Sees only their task
- Updates their own progress
- Can view exact specifications
- Gets paid based on completion
```

---

### Feature 5: **Real-time Tracking**

**What it means:** Boutique shop can see exactly where their order is

```
Boutique owner opens app and sees:

Order #ORD-2025-001
Status: TAILORING (60% complete)

Timeline:
Nov 14 âœ“ Order created by shop
Nov 14 âœ“ Order validated by Ahmed (quality checker)
Nov 15 âœ“ Work assigned:
         - Zainab: Embroidery (started)
         - Fatima: Sewing (not started yet)
Nov 16 â†’ Zainab finished embroidery
Nov 17 â†’ Fatima started sewing
Nov 18 â†’ Fatima is working (80% done)

Push Notification: "Your order is 80% complete! On track for Nov 22 delivery"
```

---

### Feature 6: **Analytics & Dashboard**

**What it means:** Everyone can see useful statistics

```
Workshop Owner sees:
- Total orders this month: 45
- Completed on time: 42 (93%)
- Revenue this month: $4,500
- Most productive tailor: Fatima (18 orders)
- Top client: Fashion Boutique A

Tailor sees:
- Orders assigned to me: 8
- Completed: 6
- In progress: 2
- Total hours worked: 24h
- Average completion time: 2.5 hours per piece

Validator sees:
- Pending validations: 3
- Validated today: 5
- Rejected (need fixes): 1
- Current workload: 15 active orders
```

---

## ğŸš€ Technical Approach (For Developers)

### Why This Architecture?

**The problem we solved:**

- Multiple user types with different needs
- Real-time order status updates
- Data must be consistent (can't have conflicting information)
- Must be scalable (handle growth)

**Our solution:**

1. **API-First Design**

   - Frontend talks to API endpoints
   - All data goes through API
   - Ensures data consistency
   - Easy to add mobile app later

2. **Role-Based Access Control**

   - Each user type has specific endpoints they can access
   - Validators cannot access tailor endpoints
   - Boutiques cannot access validator endpoints
   - Prevents unauthorized access

3. **State Machine for Orders**

   - Order must follow specific workflow
   - Cannot go backwards (COMPLETED â†’ PENDING is forbidden)
   - Only specific roles can make transitions
   - Prevents chaos and errors

4. **Audit Trail**

   - Every status change is logged
   - Timestamps recorded
   - Can answer: "When did this happen? Who did it?"
   - Helps with disputes and debugging

5. **JWT Authentication**
   - User logs in once, gets a token
   - Token proves who they are
   - Token expires after 7 days (security)
   - Simple, secure, scalable

---

## ğŸ³ Installation & Setup (Docker Compose)

### Why Docker?

Docker is like a **container** that has everything the app needs:

- Node.js (the server)
- PostgreSQL (the database)
- All dependencies

You don't need to install each separately. Just one command starts everything.

### Prerequisites

Before starting, you need:

1. **Docker Desktop** - Download from https://www.docker.com/products/docker-desktop
2. **Git** - Download from https://git-scm.com/

That's it! No need for Node.js or PostgreSQL separately.

---

### Step 1: Clone the Repository

```bash
# Copy-paste this command
git clone https://github.com/Crackers-kodikos/back-end.git
cd back-end
```

---

### Step 2: Create the Environment File

Create a file named `.env` in the project folder:

```env
PORT=3232
DATABASE_URL="postgresql://postgres:password@localhost:5433/kodikosdb"
BCRYPT_SALT_ROUNDS=5
JWT_SECRET="your-secret-key"
JWT_EXPIRES_IN="30d"
ALLOWED_ORIGINS="http://localhost:8081"
SECURE=false```

**Note:** The `DATABASE_URL` format is important. `db` is the Docker container name (not localhost).

---

### Step 3: Start Everything with Docker Compose

```bash
# This one command starts:
# 1. PostgreSQL database
# 2. Node.js API server
# 3. Runs database setup
# 4. Seeds sample data
npm run docker:compose

# AFTER THAT CHECK DOCKER LOG FILES TO WAIT FOR SERVER TO START
# YOU WILL SEE 
 server started on port 3232
 Swagger docs available at http://localhost:3232/docs

# ALTERNATIVE
docker compose up -d
```

**What happens:**

1. Docker pulls PostgreSQL image
2. Docker builds Node.js image
3. Database starts and initializes
4. API server starts
5. Sample data gets populated

**Output looks like:**

```
kodikos-db  | PostgreSQL started successfully
kodikos-api | âœ… Database ready!
kodikos-api | ğŸš€ Running migrations...
kodikos-api | ğŸŒ± Seeding database...
kodikos-api | âœ… Server running on http://localhost:3232
```

---

### Step 4: Verify It's Working

Open a new terminal and test:

```bash
# This should return a list of subscription plans
curl http://localhost:3232/
```

If you see a response its working! âœ…

---

### Step 5: Stop Everything

```bash
# If you want to completely clean up (removes data):
npm run docker:down

# ALTERNATIVE
docker-compose down -v
```

---

## ğŸ“ First Things to Try

### 1. Login as Workshop Owner

```bash
curl -X POST http://localhost:3232/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "workshop_owner_1",
    "password": "Workshop@123"
  }'
```

You'll get a token that looks like: `eyJhbGciOiJIUzI1NiIs...`

---

### 2. Get Workshop Profile

```bash
# Replace YOUR_TOKEN_HERE with the token from step 1
curl http://localhost:3232/api/workshop/profile \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

---

### 3. View Sample Orders

```bash
# View orders in the workshop
curl http://localhost:3232/api/orders \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

---

## ğŸ” Test Accounts (After Docker Setup)

When you run `docker-compose up`, it automatically creates test accounts:

```
Workshop Owner:
  Username: workshop_owner_1
  Password: Workshop@123
  Email: workshop@test.com

Tailor:
  Username: tailor_1
  Password: Tailor@123
  Email: tailor1@test.com

Validator/Quality Checker:
  Username: validator_1
  Password: Validator@123
  Email: validator@test.com

Boutique Shop Owner:
  Username: magazine_1
  Password: Magazine@123
  Email: magazine1@test.com
```

---

## ğŸ§ª Next: Use Postman for Testing

To test all endpoints easily:

1. Download Postman: https://www.postman.com/downloads/
2. Import `postman_collection.json` from the project
3. Set variables:
   - `base_url`: `http://localhost:3232`
   - `access_token`: (will auto-fill after login)
4. Click "Send" on any request

---

## ğŸ“± Connecting Frontend

Frontend developers need to know:

1. **API Base URL:** `http://localhost:3232/api`
2. **Authentication:** Send token as `Authorization: Bearer {token}`
3. **All endpoints** are documented in `API_DOCUMENTATION.md`

Example from Frontend:

```javascript
// Login
const response = await fetch("http://localhost:3232/api/auth/login", {
  method: "POST",
  body: JSON.stringify({
    username: "workshop_owner_1",
    password: "Workshop@123",
  }),
});
const data = await response.json();
const token = data.data.accessToken;

// Get workshop profile
const profile = await fetch("http://localhost:3232/api/workshop/profile", {
  headers: { Authorization: `Bearer ${token}` },
});
```

---

## ğŸ¯ Key Concepts Summary

| Concept          | What It Is                              | Example                                       |
| ---------------- | --------------------------------------- | --------------------------------------------- |
| **Order**        | A request from boutique to workshop     | "Need 5 dresses by Nov 30"                    |
| **Task**         | Individual piece of work for one tailor | "Embroider dress #1"                          |
| **Validation**   | Quality checker approves order          | Ahmed checks if order is doable               |
| **Assignment**   | Distributing tasks to tailors           | "Ahmed does embroidery, Fatima does sewing"   |
| **Status**       | Current state of order                  | PENDING â†’ VALIDATED â†’ TAILORING â†’ COMPLETED   |
| **Tracking**     | Following order progress                | "80% complete, will be ready tomorrow"        |
| **Subscription** | Monthly payment plan                    | Professional plan for $99.99 = 10 tailors max |
| **Role**         | User type and permissions               | Workshop Owner, Tailor, Validator, Boutique   |

---

## ğŸ†˜ Troubleshooting

### **Issue: "Port 3232 already in use"**

**Solution:**

```bash
# Kill the process using port 3232
lsof -ti:3232 | xargs kill -9
```

### **Issue: "Cannot connect to database"**

**Solution:**

```bash
# Check if Docker is running
docker ps

# If nothing shows, Docker isn't running - start Docker Desktop
```

### **Issue: "Permission denied: shell.sh"**

**Solution:**

```bash
chmod +x shell.sh
docker-compose build --no-cache
docker-compose up
```

### **Issue: "API returns 401 Unauthorized"**

**Solution:** Your token expired. Login again and get a new token.

---

## ğŸ“ When You Need Help

1. **Setup issues?** Check `.env` file format - `DATABASE_URL` is the most common problem
2. **API errors?** Check the token is still valid (tokens expire after 7 days)
3. **Database problems?** Run `docker-compose down -v` and `docker-compose up` fresh
4. **Can't see sample data?** Make sure seed job finished - check logs for "âœ… Created X users"

---

## ğŸ“š Related Documents

- **api-docs.html** - Complete endpoint reference
- **postman_collection.json** - Ready-to-use API tests

---

**Version:** 1.0.0  
**Ready to deploy!** ğŸš€
