### ========================================
### TAILOR OPERATIONS - COMPREHENSIVE HTTP TESTS
### ========================================
### Complete Tailor Workflow with All Scenarios
### Base URL: http://localhost:3232
### ========================================

@baseUrl = http://localhost:3232
@tailorToken = 
@validatorToken = 
@workshopToken = 
@workshopId = 1
@itemId = 1
@orderId = 1

### ========================================
### PHASE 0: SETUP - Complete Test Environment
### ========================================

### SETUP-1: Register Workshop Owner
POST {{baseUrl}}/api/auth/register/workshop
Content-Type: application/json

{
  "username": "tailor_workshop_master",
  "password": "SecurePass123!",
  "email": "tailor_workshop@test.com",
  "firstname": "Ahmed",
  "lastname": "Mohamed",
  "workshopName": "Tailor Test Workshop",
  "workshopDescription": "Complete tailor testing workshop",
  "workshopAddress": "123 Tailor Street",
  "phone": "+213600000001"
}

### SETUP-2: Create Validator for Workshop
# Get referral from workshop token
POST {{baseUrl}}/api/referral/validator
Authorization: Bearer <workshop_token_from_setup1>
Content-Type: application/json

{
  "expiresInDays": 30
}

### SETUP-3: Register Validator
POST {{baseUrl}}/api/auth/register/user
Content-Type: application/json

{
  "username": "validator_for_tailor_test",
  "password": "SecurePass123!",
  "email": "validator_tailor@test.com",
  "firstname": "Ibrahim",
  "lastname": "Hassan",
  "phone": "+213600000002",
  "userType": "VALIDATOR",
  "referralCode": "<referral_from_setup2>"
}

### SETUP-4: Login Validator
# Set @validatorToken
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "username": "validator_for_tailor_test",
  "password": "SecurePass123!"
}

### SETUP-5: Create Tailor for Testing
POST {{baseUrl}}/api/referral/tailor
Authorization: Bearer <workshop_token_from_setup1>
Content-Type: application/json

{
  "expiresInDays": 30
}

### SETUP-6: Register Tailor
# Copy token and set @tailorToken
POST {{baseUrl}}/api/auth/register/user
Content-Type: application/json

{
  "username": "tailor_test_main",
  "password": "SecurePass123!",
  "email": "tailor_main@test.com",
  "firstname": "Zainab",
  "lastname": "Hassan",
  "phone": "+213600000003",
  "userType": "TAILOR",
  "referralCode": "<referral_from_setup5>"
}

### SETUP-7: Login Tailor
# Copy accessToken and set @tailorToken
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "username": "tailor_test_main",
  "password": "SecurePass123!"
}

### SETUP-8: Create Magazine Owner
POST {{baseUrl}}/api/referral/magazine
Authorization: Bearer <workshop_token_from_setup1>
Content-Type: application/json

{
  "expiresInDays": 30
}

### SETUP-9: Register Magazine
POST {{baseUrl}}/api/auth/register/user
Content-Type: application/json

{
  "username": "magazine_for_tailor_test",
  "password": "SecurePass123!",
  "email": "magazine_tailor@test.com",
  "firstname": "Fatima",
  "lastname": "Ali",
  "phone": "+213600000004",
  "userType": "MAGAZINE_OWNER",
  "referralCode": "<referral_from_setup8>"
}

### SETUP-10: Create Order with Items
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "username": "magazine_for_tailor_test",
  "password": "SecurePass123!"
}

### SETUP-11: Create Order
# Use magazine token from SETUP-10
POST {{baseUrl}}/api/magazine/orders
Authorization: Bearer <magazine_token_from_setup10>
Content-Type: application/json

{
  "workshopId": 1,
  "orderNumber": "TAILOR-TEST-COMPLETE-001",
  "description": "Complete tailor testing workflow",
  "totalPrice": 2000.00,
  "items": [
    {
      "description": "Red silk dress with embroidery"
    },
    {
      "description": "Blue cotton dress"
    },
    {
      "description": "Green velvet dress"
    }
  ]
}

### SETUP-12: Validate Order
# Use validator token, get order ID from SETUP-11
POST {{baseUrl}}/api/orders/<orderId_from_setup11>/validate
Authorization: Bearer {{validatorToken}}
Content-Type: application/json

{
  "notes": "Order validated. Ready for assignment."
}

### SETUP-13: Assign Items to Tailor
# Get item IDs from SETUP-11 order, use validator token
POST {{baseUrl}}/api/validator/items/<item1_id>/assign
Authorization: Bearer {{validatorToken}}
Content-Type: application/json

{
  "tailorId": 1,
  "estimatedHours": 8,
  "notes": "High priority"
}

### SETUP-14: Get Tailor ID and Item IDs
# Use validator token to get workshop data
GET {{baseUrl}}/api/validator/tailors
Authorization: Bearer {{validatorToken}}

### ========================================
### PHASE 1: PROFILE MANAGEMENT - 5 Tests
### ========================================

### 1.1 - Get Tailor Profile
GET {{baseUrl}}/api/tailor/profile
Authorization: Bearer {{tailorToken}}

### 1.2 - Update Tailor Profile - Full Update
PUT {{baseUrl}}/api/tailor/profile
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "fullName": "Zainab Hassan Mohamed",
  "description": "Expert tailor specializing in embroidery and silk work",
  "skills": "Embroidery, Hand Stitching, Beading, Silk Work",
  "availabilityStatus": "available"
}

### 1.3 - Update Tailor Profile - Partial Update (Name Only)
PUT {{baseUrl}}/api/tailor/profile
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "fullName": "Zainab Hassan Ahmed"
}

### 1.4 - Update Availability Status to Busy
PUT {{baseUrl}}/api/tailor/profile
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "availabilityStatus": "busy"
}

### 1.5 - Verify Profile Changes
GET {{baseUrl}}/api/tailor/profile
Authorization: Bearer {{tailorToken}}

### ========================================
### PHASE 2: DASHBOARD & OVERVIEW - 6 Tests
### ========================================

### 2.1 - Get Tailor Dashboard
GET {{baseUrl}}/api/tailor/dashboard
Authorization: Bearer {{tailorToken}}

### 2.2 - Check Dashboard After Assignments
GET {{baseUrl}}/api/tailor/dashboard
Authorization: Bearer {{tailorToken}}

### 2.3 - View All Assigned Tasks
GET {{baseUrl}}/api/tailor/tasks
Authorization: Bearer {{tailorToken}}

### 2.4 - View Pending Tasks Only
GET {{baseUrl}}/api/tailor/tasks?status=PENDING
Authorization: Bearer {{tailorToken}}

### 2.5 - View Assigned Tasks
GET {{baseUrl}}/api/tailor/tasks?status=ASSIGNED
Authorization: Bearer {{tailorToken}}

### 2.6 - View In-Progress Tasks
GET {{baseUrl}}/api/tailor/tasks?status=IN_PROGRESS
Authorization: Bearer {{tailorToken}}

### ========================================
### PHASE 3: TASK DETAILS & INSPECTION - 5 Tests
### ========================================

### 3.1 - Get Specific Task Details
# Set @itemId from assigned items
GET {{baseUrl}}/api/tailor/tasks/{{itemId}}
Authorization: Bearer {{tailorToken}}

### 3.2 - Get Task with Order Context
GET {{baseUrl}}/api/tailor/tasks/{{itemId}}
Authorization: Bearer {{tailorToken}}

### 3.3 - Try to Get Non-Existent Task (Error Test)
GET {{baseUrl}}/api/tailor/tasks/99999
Authorization: Bearer {{tailorToken}}

### 3.4 - Get Another Task If Multiple Assigned
GET {{baseUrl}}/api/tailor/tasks/<another_itemId>
Authorization: Bearer {{tailorToken}}

### 3.5 - Verify Task Contains Order Reference
GET {{baseUrl}}/api/tailor/tasks/{{itemId}}
Authorization: Bearer {{tailorToken}}

### ========================================
### PHASE 4: TASK MANAGEMENT - STATUS UPDATES - 10 Tests
### ========================================

### 4.1 - Update Task to IN_PROGRESS
PUT {{baseUrl}}/api/tailor/tasks/{{itemId}}/status
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "newStatus": "IN_PROGRESS",
  "notes": "Started working on the red silk dress"
}

### 4.2 - Verify Status Changed to IN_PROGRESS
GET {{baseUrl}}/api/tailor/tasks/{{itemId}}
Authorization: Bearer {{tailorToken}}

### 4.3 - Update Task to COMPLETED
PUT {{baseUrl}}/api/tailor/tasks/{{itemId}}/status
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "newStatus": "COMPLETED",
  "notes": "Red silk dress completed with high quality embroidery"
}

### 4.4 - Verify Status Changed to COMPLETED
GET {{baseUrl}}/api/tailor/tasks/{{itemId}}
Authorization: Bearer {{tailorToken}}

### 4.5 - Update Second Item to IN_PROGRESS
# Get second item ID from tasks list
PUT {{baseUrl}}/api/tailor/tasks/<item2_id>/status
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "newStatus": "IN_PROGRESS",
  "notes": "Working on blue cotton dress"
}

### 4.6 - Update Second Item to COMPLETED
PUT {{baseUrl}}/api/tailor/tasks/<item2_id>/status
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "newStatus": "COMPLETED",
  "notes": "Blue cotton dress completed on time"
}

### 4.7 - Update Third Item to IN_PROGRESS
PUT {{baseUrl}}/api/tailor/tasks/<item3_id>/status
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "newStatus": "IN_PROGRESS",
  "notes": "Started green velvet dress"
}

### 4.8 - Complete Third Item
PUT {{baseUrl}}/api/tailor/tasks/<item3_id>/status
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "newStatus": "COMPLETED",
  "notes": "All items completed successfully"
}

### 4.9 - Try Invalid Status Transition (Error)
PUT {{baseUrl}}/api/tailor/tasks/{{itemId}}/status
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "newStatus": "PENDING"
}

### 4.10 - Try Invalid Status Value (Error)
PUT {{baseUrl}}/api/tailor/tasks/{{itemId}}/status
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "newStatus": "INVALID_STATUS"
}

### ========================================
### PHASE 5: STATISTICS & PERFORMANCE - 5 Tests
### ========================================

### 5.1 - Get Tailor Statistics (Before Work)
GET {{baseUrl}}/api/tailor/statistics
Authorization: Bearer {{tailorToken}}

### 5.2 - Get Updated Statistics After Starting Work
GET {{baseUrl}}/api/tailor/statistics
Authorization: Bearer {{tailorToken}}

### 5.3 - Get Final Statistics After Completing All
GET {{baseUrl}}/api/tailor/statistics
Authorization: Bearer {{tailorToken}}

### 5.4 - Get Dashboard After All Work Completed
GET {{baseUrl}}/api/tailor/dashboard
Authorization: Bearer {{tailorToken}}

### 5.5 - View All Completed Tasks
GET {{baseUrl}}/api/tailor/tasks?status=COMPLETED
Authorization: Bearer {{tailorToken}}

### ========================================
### PHASE 6: MULTI-ITEM WORKFLOW - 8 Tests
### ========================================

### 6.1 - Create Second Order
POST {{baseUrl}}/api/magazine/orders
Authorization: Bearer <magazine_token>
Content-Type: application/json

{
  "workshopId": 1,
  "orderNumber": "TAILOR-TEST-MULTI-002",
  "description": "Multi-item test order 2",
  "totalPrice": 1500.00,
  "items": [
    {
      "description": "Item A"
    },
    {
      "description": "Item B"
    }
  ]
}

### 6.2 - Validate Second Order
POST {{baseUrl}}/api/orders/<order2_id>/validate
Authorization: Bearer {{validatorToken}}
Content-Type: application/json

{
  "notes": "Second order validated"
}

### 6.3 - Assign Items from Second Order
POST {{baseUrl}}/api/validator/items/<new_item_id>/assign
Authorization: Bearer {{validatorToken}}
Content-Type: application/json

{
  "tailorId": 1,
  "estimatedHours": 6,
  "notes": "Second batch of items"
}

### 6.4 - Get Updated Task List
GET {{baseUrl}}/api/tailor/tasks
Authorization: Bearer {{tailorToken}}

### 6.5 - Get Pending Tasks from New Order
GET {{baseUrl}}/api/tailor/tasks?status=PENDING
Authorization: Bearer {{tailorToken}}

### 6.6 - Start Work on New Item
PUT {{baseUrl}}/api/tailor/tasks/<new_item_id>/status
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "newStatus": "IN_PROGRESS",
  "notes": "Starting second batch items"
}

### 6.7 - Complete New Item
PUT {{baseUrl}}/api/tailor/tasks/<new_item_id>/status
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "newStatus": "COMPLETED",
  "notes": "Second batch completed"
}

### 6.8 - View Updated Statistics
GET {{baseUrl}}/api/tailor/statistics
Authorization: Bearer {{tailorToken}}

### ========================================
### PHASE 7: CONCURRENT ASSIGNMENTS - 6 Tests
### ========================================

### 7.1 - Get Current Dashboard
GET {{baseUrl}}/api/tailor/dashboard
Authorization: Bearer {{tailorToken}}

### 7.2 - Get All Active Tasks
GET {{baseUrl}}/api/tailor/tasks
Authorization: Bearer {{tailorToken}}

### 7.3 - Assign Multiple Items at Once (Simulator)
# Assign item to same tailor multiple times
POST {{baseUrl}}/api/validator/items/<item4_id>/assign
Authorization: Bearer {{validatorToken}}
Content-Type: application/json

{
  "tailorId": 1,
  "estimatedHours": 4,
  "notes": "Concurrent item 1"
}

### 7.4 - Get Updated Dashboard with Concurrent Work
GET {{baseUrl}}/api/tailor/dashboard
Authorization: Bearer {{tailorToken}}

### 7.5 - View Total Workload
GET {{baseUrl}}/api/tailor/statistics
Authorization: Bearer {{tailorToken}}

### 7.6 - Process Multiple Tasks in Sequence
PUT {{baseUrl}}/api/tailor/tasks/<item4_id>/status
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "newStatus": "IN_PROGRESS"
}

### ========================================
### PHASE 8: ERROR HANDLING - 12 Tests
### ========================================

### E1 - Missing Authorization Header
GET {{baseUrl}}/api/tailor/profile

### E2 - Invalid Token
GET {{baseUrl}}/api/tailor/profile
Authorization: Bearer invalid_token_12345

### E3 - Non-Tailor User Accessing Tailor Endpoint
# Use validator token
GET {{baseUrl}}/api/tailor/profile
Authorization: Bearer {{validatorToken}}

### E4 - Non-Tailor User Trying to Update Status
PUT {{baseUrl}}/api/tailor/tasks/{{itemId}}/status
Authorization: Bearer {{validatorToken}}
Content-Type: application/json

{
  "newStatus": "COMPLETED"
}

### E5 - Missing Required Status Field
PUT {{baseUrl}}/api/tailor/tasks/{{itemId}}/status
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "notes": "Missing newStatus field"
}

### E6 - Invalid Status Value
PUT {{baseUrl}}/api/tailor/tasks/{{itemId}}/status
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "newStatus": "INVALID"
}

### E7 - Backward Status Transition
PUT {{baseUrl}}/api/tailor/tasks/{{itemId}}/status
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "newStatus": "ASSIGNED"
}

### E8 - Non-Existent Task
GET {{baseUrl}}/api/tailor/tasks/999999
Authorization: Bearer {{tailorToken}}

### E9 - Update Non-Existent Task
PUT {{baseUrl}}/api/tailor/tasks/999999/status
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "newStatus": "COMPLETED"
}

### E10 - Empty Profile Update
PUT {{baseUrl}}/api/tailor/profile
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
}

### E11 - Invalid Availability Status
PUT {{baseUrl}}/api/tailor/profile
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "availabilityStatus": "invalid_status"
}

### E12 - Tailor Accessing Another Tailor's Tasks
# This should only show their own tasks (by design)
GET {{baseUrl}}/api/tailor/tasks
Authorization: Bearer {{tailorToken}}

### ========================================
### PHASE 9: EDGE CASES & STRESS - 7 Tests
### ========================================

### S1 - High Volume Task Assignment Simulation
# Multiple status updates rapidly
PUT {{baseUrl}}/api/tailor/tasks/{{itemId}}/status
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "newStatus": "COMPLETED",
  "notes": "Batch completed"
}

### S2 - Long Description Text
PUT {{baseUrl}}/api/tailor/profile
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "description": "Expert tailor with 20 years of experience in traditional and modern tailoring techniques including embroidery, beading, silk work, alterations, custom designs, and specialized stitching methods"
}

### S3 - Multiple Skills Entry
PUT {{baseUrl}}/api/tailor/profile
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "skills": "Embroidery, Hand Stitching, Beading, Silk Work, Wool Work, Cotton Work, Alterations, Custom Designs, Traditional Patterns, Modern Styles, Rush Orders, Quality Assurance"
}

### S4 - Get Dashboard with Maximum Items
GET {{baseUrl}}/api/tailor/dashboard
Authorization: Bearer {{tailorToken}}

### S5 - Rapid Status Updates
PUT {{baseUrl}}/api/tailor/tasks/<item_id>/status
Authorization: Bearer {{tailorToken}}
Content-Type: application/json

{
  "newStatus": "COMPLETED",
  "notes": "Rapid update test"
}

### S6 - Large Task List Retrieval
GET {{baseUrl}}/api/tailor/tasks
Authorization: Bearer {{tailorToken}}

### S7 - Final Statistics Report
GET {{baseUrl}}/api/tailor/statistics
Authorization: Bearer {{tailorToken}}

### ========================================
### PHASE 10: WORKFLOW COMPLETENESS - 4 Tests
### ========================================

### W1 - Complete Workflow Summary: Get Profile
GET {{baseUrl}}/api/tailor/profile
Authorization: Bearer {{tailorToken}}

### W2 - Complete Workflow Summary: Get Dashboard
GET {{baseUrl}}/api/tailor/dashboard
Authorization: Bearer {{tailorToken}}

### W3 - Complete Workflow Summary: Get Statistics
GET {{baseUrl}}/api/tailor/statistics
Authorization: Bearer {{tailorToken}}

### W4 - Complete Workflow Summary: Get All Tasks
GET {{baseUrl}}/api/tailor/tasks
Authorization: Bearer {{tailorToken}}

### ========================================
### TEST EXECUTION GUIDE
### ========================================
###
### SETUP PHASE (14 tests - Do this first):
### • Creates complete test environment
### • Registers all users (workshop, validator, tailor, magazine)
### • Creates orders with items
### • Assigns items to tailor
### • Set all @variables
###
### QUICK TEST (Run these after setup):
### Phase 1: Profile (5 tests) - 2 min
### Phase 2: Dashboard (6 tests) - 2 min
### Phase 3: Tasks (5 tests) - 2 min
### Phase 4: Status Updates (10 tests) - 3 min
### Phase 5: Statistics (5 tests) - 2 min
###
### COMPREHENSIVE TEST (All phases):
### Phase 1-10: Complete workflow
### Total time: ~20 minutes
### Tests: 60+
###
### ERROR TESTING:
### Phase 8: Error handling
### Tests authorization
### Tests validation
### Tests error codes
###
### ========================================
### KEY VARIABLES TO SET
### ========================================
###
### After SETUP-1: @workshopToken
### After SETUP-4: @validatorToken
### After SETUP-7: @tailorToken
### After SETUP-11: @orderId, @itemId
### After SETUP-14: Refresh @tailorId
###
### ========================================
### TOTAL TEST COUNT
### ========================================
###
### SETUP: 14 tests
### PROFILE: 5 tests
### DASHBOARD: 6 tests
### TASK DETAILS: 5 tests
### STATUS UPDATES: 10 tests
### STATISTICS: 5 tests
### MULTI-ITEM: 8 tests
### CONCURRENT: 6 tests
### ERRORS: 12 tests
### EDGE CASES: 7 tests
### WORKFLOW: 4 tests
###
### TOTAL: 82+ COMPREHENSIVE TESTS ✅
###
### ========================================
### EXPECTED OUTCOMES
### ========================================
###
### ✅ Profile CRUD operations
### ✅ Dashboard shows accurate stats
### ✅ All tasks visible and filterable
### ✅ Status updates work correctly
### ✅ Statistics track performance
### ✅ Multiple orders work
### ✅ Concurrent assignments work
### ✅ Errors handled gracefully
### ✅ Authorization enforced
### ✅ Complete audit trail
###
### ========================================
