### ========================================
### WORKSHOP MANAGEMENT - HTTP TESTS
### ========================================
### Base URL: http://localhost:3232
### All tests require Workshop Owner token
### Tested with VS Code REST Client extension
### ========================================

@baseUrl = http://localhost:3232
@workshopToken = 
@tailorId = 1
@validatorId = 1

### ========================================
### SETUP: Get Workshop Owner Token
### ========================================

### 1. Register Workshop Owner (if needed)
POST {{baseUrl}}/api/auth/register/workshop
Content-Type: application/json

{
  "username": "workshop_test_owner",
  "password": "SecurePass123!",
  "email": "workshop_owner@test.com",
  "firstname": "Ahmed",
  "lastname": "Mohamed",
  "workshopName": "Premium Tailoring Services",
  "workshopDescription": "High-quality custom tailoring for women's clothing",
  "workshopAddress": "123 Fashion Street, Fashion District",
  "phone": "+213600000001"
}

### 2. Login as Workshop Owner
# Copy accessToken from response and set @workshopToken
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "username": "workshop_test_owner",
  "password": "SecurePass123!"
}

### ========================================
### 1. WORKSHOP PROFILE TESTS
### ========================================

### 1.1 - Get Workshop Profile
# Retrieve current workshop details and subscription
GET {{baseUrl}}/api/workshop/profile
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA

### 1.2 - Update Workshop Profile
# Update workshop name, description, address, phone, commission percentage
PUT {{baseUrl}}/api/workshop/profile
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA
Content-Type: application/json

{
  "name": "Elite Tailoring Workshop",
  "description": "Premium custom tailoring services for women's formal and casual wear",
  "address": "456 Fashion Avenue, Downtown Shopping District",
  "phone": "+213612345678",
  "commissionPercentage": 7.5
}

### 1.3 - Get Updated Workshop Profile
GET {{baseUrl}}/api/workshop/profile
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA

### ========================================
### 2. WORKSHOP DASHBOARD TESTS
### ========================================

### 2.1 - Get Workshop Dashboard Overview
# Dashboard shows stats, team members, and recent orders
GET {{baseUrl}}/api/workshop/dashboard
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA

### ========================================
### 3. TAILOR MANAGEMENT TESTS
### ========================================

### 3.1 - Get All Tailors in Workshop
# List all tailors with optional status filter
GET {{baseUrl}}/api/workshop/tailors
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA

### 3.2 - Get Available Tailors Only
GET {{baseUrl}}/api/workshop/tailors?status=available
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA

### 3.3 - Get Busy Tailors
GET {{baseUrl}}/api/workshop/tailors?status=busy
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA

### 3.4 - Get Unavailable Tailors
GET {{baseUrl}}/api/workshop/tailors?status=unavailable
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA

### 3.5 - Get Specific Tailor Details
# Replace @tailorId with actual tailor ID from 3.1 response
GET {{baseUrl}}/api/workshop/tailors/{{tailorId}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA

### 3.6 - Update Tailor Details
# Update tailor description, skills, and availability status
PUT {{baseUrl}}/api/workshop/tailors/{{tailorId}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA
Content-Type: application/json

{
  "description": "Expert tailor specializing in embroidery and detailed stitching",
  "skills": "Embroidery, Hand Stitching, Beading, Alterations, Hemming",
  "availabilityStatus": "available"
}

### 3.7 - Update Tailor to Busy
PUT {{baseUrl}}/api/workshop/tailors/{{tailorId}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA
Content-Type: application/json

{
  "availabilityStatus": "busy"
}

### 3.8 - Update Tailor to Unavailable
PUT {{baseUrl}}/api/workshop/tailors/{{tailorId}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA
Content-Type: application/json

{
  "availabilityStatus": "unavailable"
}

### 3.9 - Update Only Tailor Skills
PUT {{baseUrl}}/api/workshop/tailors/{{tailorId}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA
Content-Type: application/json

{
  "skills": "Advanced embroidery, silk stitching, traditional patterns, modern designs"
}

### ========================================
### 4. VALIDATOR MANAGEMENT TESTS
### ========================================

### 4.1 - Get All Validators in Workshop
GET {{baseUrl}}/api/workshop/validators
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA

### 4.2 - Get Specific Validator Details
# Replace @validatorId with actual validator ID from 4.1 response
GET {{baseUrl}}/api/workshop/validators/{{validatorId}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA

### 4.3 - Update Validator Details
PUT {{baseUrl}}/api/workshop/validators/{{validatorId}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA
Content-Type: application/json

{
  "fullName": "Ibrahim Ahmed Hassan",
  "description": "Senior Quality Checker with 10 years experience in tailoring"
}

### 4.4 - Update Validator Name Only
PUT {{baseUrl}}/api/workshop/validators/{{validatorId}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA
Content-Type: application/json

{
  "fullName": "Updated Name"
}

### ========================================
### 5. MAGAZINE MANAGEMENT TESTS
### ========================================

### 5.1 - Get All Connected Magazines/Shops
# View all shops that are registered with this workshop
GET {{baseUrl}}/api/workshop/magazines
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA

### ========================================
### 6. WORKSHOP STATISTICS TESTS
### ========================================

### 6.1 - Get Detailed Workshop Statistics
# Get comprehensive business statistics including:
# - Team counts (tailors, validators, magazines)
# - Order statistics by status (PENDING, VALIDATED, TAILORING, PACKAGING, COMPLETED)
# - Total revenue
# - Workshop info
GET {{baseUrl}}/api/workshop/statistics
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA

### ========================================
### ERROR HANDLING TESTS
### ========================================

### E1 - Test Update with Invalid Tailor ID
# Should return 404 Not Found
PUT {{baseUrl}}/api/workshop/tailors/99999
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA
Content-Type: application/json

{
  "description": "This should fail"
}

### E2 - Test Get with Invalid Validator ID
# Should return 404 Not Found
GET {{baseUrl}}/api/workshop/validators/99999
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA

### E3 - Test Update with Invalid Status
# Should accept valid statuses: available, busy, unavailable
PUT {{baseUrl}}/api/workshop/tailors/{{tailorId}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA
Content-Type: application/json

{
  "availabilityStatus": "invalid_status"
}

### E4 - Test Update with No Fields
# Should return 400 Bad Request (nothing to update)
PUT {{baseUrl}}/api/workshop/profile
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6OCwidXNlclR5cGUiOiJXT1JLU0hPUF9PV05FUiIsIndvcmtzaG9wSWQiOjUsIndvcmtzaG9wTmFtZSI6IlByZW1pdW0gVGFpbG9yaW5nIFNlcnZpY2VzIiwiaWF0IjoxNzYzMTUxNjcxLCJleHAiOjE3NjU3NDM2NzF9.ORQrv5h9F8ZJzBKosJBTEx-obS_mrxqE7aXCc2FTfIA
Content-Type: application/json

{}

### ========================================
### AUTHENTICATION & AUTHORIZATION TESTS
### ========================================

### A1 - Test Without Token
# Should return 401 Unauthorized
GET {{baseUrl}}/api/workshop/profile

### A2 - Test With Invalid Token
# Should return 403 Forbidden
GET {{baseUrl}}/api/workshop/profile
Authorization: Bearer invalid_token_123

### A3 - Test Non-Workshop-Owner Access
# Register non-workshop user and try to access workshop routes
# Should return 403 Forbidden (only workshop owners allowed)
POST {{baseUrl}}/api/auth/register/user
Content-Type: application/json

{
  "username": "magazine_user_test",
  "password": "SecurePass123!",
  "email": "magazine@test.com",
  "firstname": "Fatima",
  "lastname": "Ali",
  "userType": "MAGAZINE_OWNER",
  "referralCode": "any_code_here"
}

### ========================================
### TESTING WORKFLOW GUIDE
### ========================================
###
### STEP 1: Setup
### • Register workshop owner (1)
### • Login and copy accessToken (2)
### • Set @workshopToken = <accessToken>
###
### STEP 2: Profile Management
### • Get profile (1.1)
### • Update profile (1.2)
### • Verify update (1.3)
###
### STEP 3: Dashboard
### • View dashboard (2.1)
### • Check team and order stats
###
### STEP 4: Tailor Management
### • List all tailors (3.1)
### • Get specific tailor (3.5)
### • Note the tailor ID
### • Set @tailorId = <id>
### • Update tailor (3.6)
### • Test status changes (3.7, 3.8)
###
### STEP 5: Validator Management
### • List validators (4.1)
### • Note validator ID
### • Set @validatorId = <id>
### • Get details (4.2)
### • Update validator (4.3)
###
### STEP 6: Other Features
### • View magazines (5.1)
### • View statistics (6.1)
###
### STEP 7: Error Testing
### • Test invalid IDs (E1, E2)
### • Test invalid data (E3, E4)
### • Test auth errors (A1, A2, A3)
###
### ========================================
### EXPECTED STATUS CODES
### ========================================
###
### 200 OK - Successful GET or PUT
### 201 CREATED - Resource created (not used here)
### 400 BAD REQUEST - Invalid input or no fields to update
### 401 UNAUTHORIZED - Missing or invalid token
### 403 FORBIDDEN - Not authorized (not workshop owner)
### 404 NOT FOUND - Resource doesn't exist
### 500 INTERNAL SERVER ERROR - Server error
###
### ========================================
### RESPONSE EXAMPLES
### ========================================
###
### SUCCESS (200):
### {
###   "success": true,
###   "message": "Workshop profile retrieved successfully",
###   "data": { ... }
### }
###
### ERROR (400):
### {
###   "success": false,
###   "message": "No fields to update"
### }
###
### ERROR (404):
### {
###   "success": false,
###   "message": "Workshop not found"
### }
###
### ========================================
### QUICK REFERENCE
### ========================================
###
### Profile Management:
###   GET    /profile            - Retrieve workshop
###   PUT    /profile            - Update workshop
###
### Dashboard:
###   GET    /dashboard          - View overview
###
### Tailor Management:
###   GET    /tailors            - List tailors
###   GET    /tailors/:id        - Get tailor
###   PUT    /tailors/:id        - Update tailor
###
### Validator Management:
###   GET    /validators         - List validators
###   GET    /validators/:id     - Get validator
###   PUT    /validators/:id     - Update validator
###
### Other:
###   GET    /magazines          - List magazines
###   GET    /statistics         - Get stats
###
### Filters:
###   ?status=available    - Filter tailors by availability
###   ?status=busy
###   ?status=unavailable
###
### ========================================
### TIPS
### ========================================
###
### • Use Ctrl+Alt+R to run request
### • Click "Send Request" link above each test
### • Save important IDs in variables (@tailorId, @validatorId)
### • Check Response panel for JSON output
### • Use "Pretty Print" for readable JSON
### • Test error cases to ensure proper error handling
### • Verify status codes match expectations
###
### ========================================
